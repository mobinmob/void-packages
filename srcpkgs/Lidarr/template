# Template file for 'Lidarr'
pkgname=Lidarr
version=0.7.1.1381
revision=1
hostmakedepends="msbuild-bin mono nodejs-lts yarn"
makedepends="libgdiplus-devel"
depends="mono libmediainfo"
short_desc="Music collection manager for Usenet and BitTorrent users"
maintainer="Young Jin Park <youngjinpark20@gmail.com>"
license="GPL-3.0-or-later"
homepage="http://lidarr.audio/"
distfiles="https://github.com/lidarr/Lidarr/archive/v${version}.tar.gz"
checksum="3b83a25c9f8bbb66fc74b7ee13d4fd10d204b0c625cfdca80d906b8338bb8c44"

system_accounts="lidarr"
lidarr_homedir="/var/lib/lidarr"

case "$XBPS_TARGET_MACHINE" in
	i686*) broken="yarn broken on i686"
esac

make_dirs="
 /var/log/Lidarr/ 700 lidarr lidarr
 /var/lib/lidarr/ 750 lidarr lidarr"

pre_build() {
	mono tools/nuget/nuget.exe update -self
}

do_build() {
	./build.sh
}

do_install() {
	vmkdir usr/lib/Lidarr
	vcopy _output_linux/* usr/lib/Lidarr
	vbin ${FILESDIR}/lidarr
	vsv Lidarr
}
