# Template file for 'TeXmacs'
pkgname=TeXmacs
version=1.99.12
revision=1
wrksrc="${pkgname}-${version}-src"
build_style=cmake
configure_args="-DCMAKE_BUILD_TYPE=RELEASE \
	-DCMAKE_INSTALL_PREFIX=/usr \
	-DGUILECONFIG_EXECUTABLE=/usr/bin/guile-config-1.8"
hostmakedepends="pkg-config extra-cmake-modules"
makedepends="freetype-devel qt5-devel guile1.8-devel libjpeg-turbo-devel libXext-devel python-devel sqlite-devel"
depends="ImageMagick aspell texlive-bin ghostscript"
short_desc="Free scientific editing platform"
maintainer="mobinmob <mobinmob@disroot.org>"
license="GPL-3.0-or-later"
homepage="https://www.texmacs.org"
distfiles="http://www.texmacs.org/Download/ftp/tmftp/source/TeXmacs-${version}-src.tar.gz"
checksum=6a513d2aa8d1bf851b603a023551cc36e170093e9a9a14099b75d4c3cb2a0812

case "$XBPS_TARGET_MACHINE" in
*-musl)
	makedepends+=" libexecinfo-devel"
	depends+=" libexecinfo"
	LDFLAGS="-lexecinfo -lc"
esac

if [ "$CROSS_BUILD" ]; then
	hostmakedepends+=" qt5-host-tools qt5-qmake"
fi


post_install() {
	# Move binary plugins to /usr/bin.
	mv $DESTDIR/usr/share/TeXmacs/plugins/axiom/bin/tm_axiom $DESTDIR/usr/bin/
	mv $DESTDIR/usr/share/TeXmacs/plugins/coq/bin/tm_coq $DESTDIR/usr/bin/
	mv $DESTDIR/usr/share/TeXmacs/plugins/maple/bin/tm_maple_5 $DESTDIR/usr/bin/
	mv $DESTDIR/usr/share/TeXmacs/plugins/r/bin/tm_r $DESTDIR/usr/bin/
	mv $DESTDIR/usr/share/TeXmacs/plugins/shell/bin/tm_shell $DESTDIR/usr/bin/
}
